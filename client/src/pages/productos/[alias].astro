---
import AddToCart from "../../components/categoriasHome/AddToCart";
import SelectorCategoriasModulo from "../../components/selectorCategorias/SelectorCategoriasModulo.astro";
import PrincipalLayaout from "../../layouts/PrincipalLayaout.astro";
import type { CartItem, Producto } from "../../types/General.type";
import MasMenosBTN from "../../components/carrito/MasMenosBTN";
import BarraCarrito from "../../components/barraCarrito/BarraCarrito";
import Modulos from "../../components/Modulos.astro";

export const prerender = false;
const response = await fetch(
  `${import.meta.env.PUBLIC_VITE_BACKEND_URL}/api/productos`,
);

const productos = (await response.json()) as Producto[];

interface Props {
  alias: string;
}

const { alias } = Astro.params;

const productoEncontrado = productos.find(p => p.alias === alias) ?? {} as Producto;

---

<PrincipalLayaout
  title={productoEncontrado?.nombre ?? ""}
  description={productoEncontrado?.description ?? ""}
  img_url={`${import.meta.env.PUBLIC_VITE_BACKEND_URL}/images/productos/${productoEncontrado?.image}`}
  url={`https://www.tiendalaemiliana.com/productos/${productoEncontrado?.alias}`}
>
  <section class="bg-neutral-200 p-3 mt-5">
    <img
      transition:name={`producto-${productoEncontrado?.id}`}
      class="w-full h-full rounded-xl object-cover mb-5"
      src={`${import.meta.env.PUBLIC_VITE_BACKEND_URL}/images/productos/${productoEncontrado?.image}`}
      alt={productoEncontrado?.nombre}
    />
    <div class="flex justify-between items-center">
      <h2 class="font-bold text-3xl">{productoEncontrado?.nombre}</h2>
      <h2 class="font-semibold text-3xl">
        {productoEncontrado?.price_usd}
        <span class="text-xs font-semibold text-neutral-600 mt-3">USD</span>
      </h2>
    </div>
    <h2 class="font-semibold text-neutral-400 text-sm">Descripci√≥n</h2>
    <p>{productoEncontrado?.description}</p>
  </section>
  {
    productoEncontrado?.stock  < 1 ? (
      "Producto Agotado "
    ) : (
      <div class="flex justify-center items-center gap-5 mt-5">
        <AddToCart
          producto={productoEncontrado as Producto}
          colorBtn="bg-green-500"
          client:visible
        />

        <MasMenosBTN id={productoEncontrado?.id ?? 0} client:visible />
      </div>
    )
  }
  <SelectorCategoriasModulo />
  <Modulos productos={productos} />
  <BarraCarrito client:visible />
</PrincipalLayaout>
